@using Radzen.Blazor.Spreadsheet
@implements IDisposable

<RadzenSplitButton Icon="view_column" Text="Freeze panes" Click=@OnFreezeClick ButtonStyle="ButtonStyle.Base" Disabled=@IsDisabled>
    <ChildContent>
        <RadzenSplitButtonItem Text="Freeze Top Row" Value="row" Icon="view_column" />
        <RadzenSplitButtonItem Text="Freeze Selected Rows" Value="rows" Icon="view_column" />
        <RadzenSplitButtonItem Text="Freeze First Column" Value="column" Icon="view_column" />
        <RadzenSplitButtonItem Text="Freeze Selected Columns" Value="columns" Icon="view_column" />
        <RadzenSplitButtonItem Text="Unfreeze" Value="unfreeze" Icon="view_column" />
    </ChildContent>
</RadzenSplitButton>

@code {
#nullable enable

    [Parameter]
    public Sheet? Sheet { get; set; }

    private bool IsDisabled => Sheet?.Selection.Cell == CellRef.Invalid;

    private void OnFreezeClick(RadzenSplitButtonItem? item)
    {
        switch (item?.Value)
        {
            case null:
                FreezePanes();
                break;
            case "row":
                FreezeTopRow();
                break;
            case "rows":
                FreezeRows();
                break;
            case "column":
                FreezeFirstColumn();
                break;
            case "columns":
                FreezeColumns();
                break;
            case "range":
                FreezePanes();
                break;
            case "unfreeze":
                Unfreeze();
                break;
        }
    }

    private void FreezeFirstColumn()
    {
        if (Sheet != null && Sheet.Selection.Cell != CellRef.Invalid)
        {
            Sheet.Rows.Frozen = 0;
            Sheet.Columns.Frozen = 1;
        }
    }

    private void FreezeTopRow()
    {
        if (Sheet != null && Sheet.Selection.Cell != CellRef.Invalid)
        {
            Sheet.Rows.Frozen = 1;
            Sheet.Columns.Frozen = 0;
        }
    }

    private void FreezeRows()
    {
        if (Sheet != null && Sheet.Selection.Cell != CellRef.Invalid)
        {
            var frozenRows = Sheet.Selection.Cell.Row;
            Sheet.Rows.Frozen = frozenRows;
        }
    }

    private void FreezeColumns()
    {
        if (Sheet != null && Sheet.Selection.Cell != CellRef.Invalid)
        {
            Sheet.Columns.Frozen = Sheet.Selection.Cell.Column;
        }
    }

    private void FreezePanes()
    {
        if (Sheet != null && Sheet.Selection.Cell != CellRef.Invalid)
        {
            Sheet.Rows.Frozen = Sheet.Selection.Cell.Row;
            Sheet.Columns.Frozen = Sheet.Selection.Cell.Column;
        }
    }

    private void Unfreeze()
    {
        if (Sheet != null)
        {
            Sheet.Rows.Frozen = 0;
            Sheet.Columns.Frozen = 0;
        }
    }

    public override async Task SetParametersAsync(ParameterView parameters)
    {
        if (Sheet?.Selection != null)
        {
            Sheet.Selection.Changed -= OnSelectionChanged;
        }

        await base.SetParametersAsync(parameters);

        if (Sheet?.Selection != null)
        {
            Sheet.Selection.Changed += OnSelectionChanged;
        }
    }

    private void OnSelectionChanged()
    {
        StateHasChanged();
    }

    public void Dispose()
    {
        if (Sheet?.Selection != null)
        {
            Sheet.Selection.Changed -= OnSelectionChanged;
        }
    }
} 